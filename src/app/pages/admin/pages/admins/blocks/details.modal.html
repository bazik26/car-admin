@if (isLoading()) {
  <div class="modal-body text-center p-5">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Загрузка...</span>
    </div>
    <p class="mt-3">Загрузка данных администратора...</p>
  </div>
} @else if (adminData(); as admin) {
  <div class="admin-details-modal">
    <!-- Modal Header -->
    <div class="modal-header">
      <div class="d-flex align-items-center justify-content-between w-100">
        <div>
          <h4 class="mb-0">{{ admin.email }}</h4>
          @if (admin.isSuper) {
            <span class="badge bg-warning text-dark ms-2">
              <i class="fas fa-crown"></i> Супер-администратор
            </span>
          }
        </div>
        <button type="button" class="btn-close" (click)="closeModal()" aria-label="Close"></button>
      </div>
    </div>

    <!-- Modal Body -->
    <div class="modal-body">
      @if (!isEditing()) {
        <!-- Режим просмотра -->
        <div class="info-section mb-4">
          <h5 class="mb-3">Основная информация</h5>
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Email</label>
              <div class="fw-bold">{{ admin.email }}</div>
            </div>
            <div class="col-md-6">
              <label class="form-label">Статус</label>
              <div>
                <span class="badge" [class.bg-success]="!admin.deletedAt" [class.bg-danger]="admin.deletedAt">
                  {{ admin.deletedAt ? 'Удален' : 'Активен' }}
                </span>
              </div>
            </div>
            <div class="col-md-6">
              <label class="form-label">Роль</label>
              <div>
                <span class="badge" [class.bg-warning]="admin.isSuper" [class.bg-secondary]="!admin.isSuper">
                  {{ admin.isSuper ? 'Супер-администратор' : 'Менеджер' }}
                </span>
              </div>
            </div>
            <div class="col-md-6">
              <label class="form-label">Дата создания</label>
              <div>{{ formatDate(admin.createdAt) }}</div>
            </div>
          </div>
        </div>

        <div class="info-section mb-4">
          <h5 class="mb-3">Принадлежность к проекту</h5>
          <div class="row g-3">
            <div class="col-md-12">
              <label class="form-label">Проект</label>
              <div>
                <span class="badge bg-info">
                  {{ getProjectLabel(admin.projectId) }}
                </span>
              </div>
            </div>
          </div>
        </div>

        <div class="info-section mb-4">
          <h5 class="mb-3">Разрешения</h5>
          <div class="permissions-list">
            <div class="permission-item">
              <div class="d-flex align-items-center justify-content-between">
                <div>
                  <i class="fas fa-car text-primary me-2"></i>
                  <span>Добавлять автомобили</span>
                </div>
                <span class="badge" [class.bg-success]="admin.permissions?.canAddCars" [class.bg-secondary]="!admin.permissions?.canAddCars">
                  {{ admin.permissions?.canAddCars ? 'Разрешено' : 'Запрещено' }}
                </span>
              </div>
            </div>
            <div class="permission-item">
              <div class="d-flex align-items-center justify-content-between">
                <div>
                  <i class="fas fa-eye text-primary me-2"></i>
                  <span>Просматривать автомобили</span>
                </div>
                <span class="badge" [class.bg-success]="admin.permissions?.canViewCars" [class.bg-secondary]="!admin.permissions?.canViewCars">
                  {{ admin.permissions?.canViewCars ? 'Разрешено' : 'Запрещено' }}
                </span>
              </div>
            </div>
            <div class="permission-item">
              <div class="d-flex align-items-center justify-content-between">
                <div>
                  <i class="fas fa-user-tie text-primary me-2"></i>
                  <span>Обслуживать лидов (с редактированием)</span>
                </div>
                <span class="badge" [class.bg-success]="admin.permissions?.canManageLeads" [class.bg-secondary]="!admin.permissions?.canManageLeads">
                  {{ admin.permissions?.canManageLeads ? 'Разрешено' : 'Запрещено' }}
                </span>
              </div>
            </div>
            <div class="permission-item">
              <div class="d-flex align-items-center justify-content-between">
                <div>
                  <i class="fas fa-eye text-primary me-2"></i>
                  <span>Смотреть лидов (без редактирования)</span>
                </div>
                <span class="badge" [class.bg-success]="admin.permissions?.canViewLeads" [class.bg-secondary]="!admin.permissions?.canViewLeads">
                  {{ admin.permissions?.canViewLeads ? 'Разрешено' : 'Запрещено' }}
                </span>
              </div>
            </div>
          </div>
        </div>
      } @else {
        <!-- Режим редактирования -->
        <div class="info-section mb-4">
          <h5 class="mb-3">Редактирование информации</h5>
          
          <div class="mb-3">
            <label class="form-label">Принадлежность к проекту</label>
            <select class="form-select" [(ngModel)]="editForm.projectId">
              <option value="">Не назначен</option>
              <option value="office_1">Офис 1</option>
              <option value="office_2">Офис 2</option>
            </select>
          </div>

          <div class="mb-3">
            <label class="form-label">Разрешения</label>
            <div class="permissions-edit">
              <div class="form-check mb-2">
                <input 
                  class="form-check-input" 
                  type="checkbox" 
                  id="canAddCars"
                  [(ngModel)]="editForm.permissions.canAddCars">
                <label class="form-check-label" for="canAddCars">
                  <i class="fas fa-car me-2"></i>Добавлять автомобили
                </label>
              </div>
              <div class="form-check mb-2">
                <input 
                  class="form-check-input" 
                  type="checkbox" 
                  id="canViewCars"
                  [(ngModel)]="editForm.permissions.canViewCars">
                <label class="form-check-label" for="canViewCars">
                  <i class="fas fa-eye me-2"></i>Просматривать автомобили
                </label>
              </div>
              <div class="form-check mb-2">
                <input 
                  class="form-check-input" 
                  type="checkbox" 
                  id="canManageLeads"
                  [(ngModel)]="editForm.permissions.canManageLeads">
                <label class="form-check-label" for="canManageLeads">
                  <i class="fas fa-user-tie me-2"></i>Обслуживать лидов (с редактированием)
                </label>
              </div>
              <div class="form-check mb-2">
                <input 
                  class="form-check-input" 
                  type="checkbox" 
                  id="canViewLeads"
                  [(ngModel)]="editForm.permissions.canViewLeads">
                <label class="form-check-label" for="canViewLeads">
                  <i class="fas fa-eye me-2"></i>Смотреть лидов (без редактирования)
                </label>
              </div>
            </div>
          </div>
        </div>
      }
    </div>

    <!-- Modal Footer -->
    <div class="modal-footer">
      @if (!isEditing()) {
        <button type="button" class="btn btn-secondary" (click)="closeModal()">Закрыть</button>
        <button type="button" class="btn btn-primary" (click)="toggleEdit()">
          <i class="fas fa-edit me-1"></i>Редактировать
        </button>
      } @else {
        <button type="button" class="btn btn-secondary" (click)="cancelEdit()">Отмена</button>
        <button type="button" class="btn btn-primary" (click)="saveChanges()">
          <i class="fas fa-save me-1"></i>Сохранить
        </button>
      }
    </div>
  </div>
}

