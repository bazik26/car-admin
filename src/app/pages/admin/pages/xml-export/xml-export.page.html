<section class="xml-export-page animate-fade-in">
  <header class="page-header-glass animate-slide-in-top">
    <div class="page-header-text">
      <span class="eyebrow-label">
        <i class="fas fa-download"></i>
        Экспорт данных
      </span>
      <h2 class="page-title">Экспорт YML каталога</h2>
      <p class="page-subtitle">
        Экспорт списка всех активных автомобилей в формате YML для Яндекс.Маркета и рекламных интеграций для выбранного сайта.
      </p>
    </div>
    <div class="page-header-actions">
      <div class="stats-chip">
        <i class="fas fa-car"></i>
        <span>{{ cars.length }}</span>
        <small>активных автомобилей</small>
      </div>
      <button class="btn btn-lion" type="button" (click)="refreshData()" [disabled]="loading">
        <i class="fas fa-sync-alt" [class.fa-spin]="loading"></i>
        <span>{{ loading ? 'Обновляем...' : 'Обновить данные' }}</span>
      </button>
    </div>
  </header>

  @if (loading) {
    <div class="loading-state glass-card animate-fade-in">
      <div class="loading-spinner-large">
        <i class="fas fa-download fa-spin"></i>
      </div>
      <p class="loading-text">Загружаем данные автомобилей...</p>
    </div>
  } @else if (error) {
    <div class="alert alert-danger animate-slide-in-top">
      <i class="fas fa-exclamation-triangle me-2"></i>
      {{ error }}
    </div>
  } @else {
    <div class="export-content animate-scale-in">
      <div class="export-stats glass-card">
        <div class="stat-item">
          <div class="stat-icon">
            <i class="fas fa-car"></i>
          </div>
          <div class="stat-info">
            <span class="stat-label">Всего автомобилей</span>
            <strong class="stat-value">{{ cars.length }}</strong>
          </div>
        </div>
        
        <div class="stat-item">
          <div class="stat-icon">
            <i class="fas fa-calendar"></i>
          </div>
          <div class="stat-info">
            <span class="stat-label">Дата экспорта</span>
            <strong class="stat-value">{{ currentDate }}</strong>
          </div>
        </div>
      </div>

      <div class="website-selector glass-card">
        <div class="selector-header">
          <h3>
            <i class="fas fa-globe"></i>
            Выбор сайта
          </h3>
          <p class="selector-hint">
            Выберите сайт, для которого хотите сгенерировать YML-каталог
          </p>
        </div>
        <div class="selector-content">
          <ng-select
            [(ngModel)]="selectedWebsite"
            [items]="websites"
            bindLabel="name"
            [clearable]="false"
            [searchable]="false"
            (change)="onWebsiteChange()"
            placeholder="Выберите сайт"
            class="website-select"
            appendTo="body"
          >
            <ng-template ng-label-tmp let-item="item">
              <div class="selected-website">
                <i class="fas fa-globe"></i>
                <span class="website-name">{{ item.name }}</span>
                <small class="website-url">{{ item.url }}</small>
              </div>
            </ng-template>
            <ng-template ng-option-tmp let-item="item">
              <div class="website-option">
                <strong>{{ item.name }}</strong>
                <small>{{ item.url }}</small>
              </div>
            </ng-template>
          </ng-select>
        </div>
      </div>

      <div class="export-link glass-card">
        <div class="link-header">
          <h3>
            <i class="fas fa-link"></i>
            Ссылка на YML-фид
          </h3>
        </div>
        <div class="link-content">
          <div class="url-input-group">
            <input 
              type="text" 
              class="url-input" 
              [value]="ymlFeedUrl" 
              readonly
              #urlInput
            />
            <button 
              class="btn btn-primary" 
              (click)="copyUrl(urlInput)"
              title="Копировать ссылку"
            >
              <i class="fas fa-copy"></i>
              Копировать
            </button>
          </div>
          <p class="url-hint">
            Используйте эту ссылку для подключения YML-фида в рекламных кабинетах (Яндекс.Директ, Google Ads и др.)
          </p>
        </div>
      </div>

      <div class="export-actions glass-card">
        <div class="action-buttons">
          <button 
            class="btn btn-primary" 
            (click)="copyToClipboard()"
            [disabled]="!xmlContent"
          >
            <i class="fas fa-copy"></i>
            <span>Копировать YML</span>
          </button>
          
          <button 
            class="btn btn-success" 
            (click)="downloadXml()"
            [disabled]="!xmlContent"
          >
            <i class="fas fa-download"></i>
            <span>Скачать YML</span>
          </button>
          
          <button 
            class="btn btn-info" 
            (click)="toggleXmlView()"
            [disabled]="!xmlContent"
          >
            <i class="fas fa-eye"></i>
            <span>{{ showXml ? 'Скрыть YML' : 'Показать YML' }}</span>
          </button>
        </div>
      </div>

      @if (showXml && xmlContent) {
        <div class="xml-preview glass-card animate-slide-in-bottom">
          <div class="xml-header">
            <h3>
              <i class="fas fa-code"></i>
              Предварительный просмотр YML
            </h3>
            <button class="btn btn-sm btn-outline" (click)="copyToClipboard()">
              <i class="fas fa-copy"></i>
              Копировать
            </button>
          </div>
          <pre class="xml-content">{{ xmlContent }}</pre>
        </div>
      }
    </div>
  }
</section>
