<div class="task-details-modal">
  <div class="modal-header">
    <h5 class="modal-title">{{ task.title }}</h5>
    <button type="button" class="btn-close" (click)="cancel()"></button>
  </div>
  
  <div class="modal-body">
    <!-- Цель задачи -->
    @if (getGoal()) {
      <div class="task-goal">
        <div class="goal-label">Цель</div>
        <div class="goal-text">{{ getGoal() }}</div>
      </div>
    }

    <!-- Скрипт звонка/беседы -->
    @if (getScript()) {
      <div class="task-script">
        <div class="script-label">Скрипт</div>
        <div class="script-content" [innerHTML]="formatScript(getScript())"></div>
      </div>
    }

    <!-- Поля для заполнения -->
    @if (taskFields().length > 0) {
      <div class="task-fields">
        <div class="fields-label">Заполните поля</div>
        <div class="fields-grid">
          @for (field of taskFields(); track field.key) {
            <div class="field-item">
              <label class="field-label">
                {{ field.label }}
                @if (field.required) {
                  <span class="required-mark">*</span>
                }
              </label>
              <input 
                type="text" 
                class="field-input"
                [class.field-error]="field.required && (!taskForm.taskData[field.key] || taskForm.taskData[field.key].trim().length === 0)"
                [(ngModel)]="taskForm.taskData[field.key]"
                (ngModelChange)="updateFieldValue(field.key, $event)"
                [placeholder]="'Введите ' + field.label.toLowerCase()"
              />
            </div>
          }
        </div>
      </div>
    }

    <!-- Дедлайн -->
    @if (task.dueDate) {
      <div class="task-deadline">
        <i class="fas fa-clock"></i>
        <span>Дедлайн: {{ formatDate(task.dueDate) }}</span>
      </div>
    }
  </div>
  
  <div class="modal-footer">
    <button type="button" class="btn-cancel" (click)="cancel()">Отмена</button>
    <button type="button" class="btn-save" (click)="save()" [disabled]="isSaving()">
      @if (isSaving()) {
        <span class="spinner"></span>
      }
      Сохранить
    </button>
    <button type="button" class="btn-complete" (click)="completeTask()" [disabled]="isSaving() || !canCompleteTask()">
      @if (!isSaving()) {
        <i class="fas fa-check"></i>
      } @else {
        <span class="spinner"></span>
      }
      Завершить
    </button>
  </div>
</div>
