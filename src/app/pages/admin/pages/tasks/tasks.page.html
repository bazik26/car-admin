<div class="tasks-page">
  <div class="page-header mb-4">
    <h1 class="page-title">
      <i class="fas fa-tasks me-2"></i>
      Мои задачи
    </h1>
    <p class="text-muted">Управление задачами по обработке лидов</p>
  </div>

  <!-- Фильтры -->
  <div class="filters-section mb-4">
    <div class="row g-3">
      <div class="col-md-4">
        <label class="form-label">Статус</label>
        <select class="form-select" [value]="filterStatus()" (change)="setFilterStatus($any($event.target).value)">
          <option value="all">Все</option>
          <option value="pending">Ожидают</option>
          <option value="in_progress">В работе</option>
          <option value="completed">Выполнены</option>
        </select>
      </div>
      <div class="col-md-4">
        <label class="form-label">Выполнение</label>
        <select class="form-select" [value]="filterCompleted() === null ? 'all' : filterCompleted() ? 'completed' : 'not_completed'" 
                (change)="setFilterCompleted($any($event.target).value === 'all' ? null : $any($event.target).value === 'completed')">
          <option value="all">Все</option>
          <option value="completed">Выполненные</option>
          <option value="not_completed">Не выполненные</option>
        </select>
      </div>
      <div class="col-md-4 d-flex align-items-end">
        <button class="btn btn-primary w-100" (click)="loadTasks()">
          <i class="fas fa-sync-alt me-2"></i>
          Обновить
        </button>
      </div>
    </div>
  </div>

  <!-- Список задач -->
  @if (isLoading()) {
    <div class="text-center p-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Загрузка...</span>
      </div>
      <p class="mt-3 text-muted">Загрузка задач...</p>
    </div>
  } @else if (tasks().length === 0) {
    <div class="empty-state text-center p-5">
      <i class="fas fa-tasks fa-3x text-muted mb-3"></i>
      <h3>Нет задач</h3>
      <p class="text-muted">У вас пока нет задач. Задачи будут автоматически созданы при назначении новых лидов.</p>
    </div>
  } @else {
    <div class="tasks-list">
      @for (task of tasks(); track task.id) {
        <div class="task-card mb-3" [class.task-overdue]="isOverdue(task.dueDate)" (click)="openTaskDetails(task)">
          <div class="card">
            <div class="card-body">
              <div class="row align-items-center">
                <div class="col-md-6">
                  <div class="d-flex align-items-start">
                    <div class="task-icon me-3">
                      <i class="fas fa-circle-check text-success" *ngIf="task.completed"></i>
                      <i class="fas fa-circle" *ngIf="!task.completed"></i>
                    </div>
                    <div class="task-info flex-grow-1">
                      <h5 class="task-title mb-1">
                        {{ task.title }}
                        <span class="badge ms-2" [ngClass]="getStatusBadgeClass(task.status)">
                          {{ getStatusLabel(task.status) }}
                        </span>
                      </h5>
                      <p class="task-description text-muted mb-2" *ngIf="task.description">
                        {{ task.description }}
                      </p>
                      <div class="task-meta">
                        <span class="badge bg-secondary me-2">
                          <i class="fas fa-tag me-1"></i>
                          {{ getTaskTypeLabel(task.taskType) }}
                        </span>
                        @if (task.lead) {
                          <span class="text-muted">
                            <i class="fas fa-user me-1"></i>
                            {{ task.lead.name }}
                          </span>
                        }
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-md-6 text-end">
                  <div class="task-dates">
                    @if (task.dueDate) {
                      <div class="due-date" [class.text-danger]="isOverdue(task.dueDate)">
                        <i class="fas fa-calendar-alt me-1"></i>
                        <strong>Срок:</strong> {{ formatDate(task.dueDate) }}
                        @if (isOverdue(task.dueDate)) {
                          <span class="badge bg-danger ms-2">Просрочено</span>
                        }
                      </div>
                    }
                    @if (task.completedAt) {
                      <div class="completed-date text-success mt-2">
                        <i class="fas fa-check-circle me-1"></i>
                        Выполнено: {{ formatDate(task.completedAt) }}
                      </div>
                    }
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      }
    </div>
  }
</div>




